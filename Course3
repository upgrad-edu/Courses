
import React, { useContext, useState } from 'react'
import { Label, Input, PasswordInput, Button } from '@americanexpress/dls-react'

import { githubTokenContext } from '../contexts/GithubTokenProvider'
import getAllroutes from '../api/getAllRoutes'



function Login() {
  
  const { setToken, setUsername } = useContext(githubTokenContext)
  
  const [userName, setUserName] = useState('')
  const [ghtoken, setghToken] = useState('')
  const [loginError, setLoginError] = useState(false)

  function handleLogin() {
    getAllroutes('sandbox', 'salesforce', ghtoken)
      .then((res) => { 
        setToken(ghtoken);
        setUsername(userName);
      })
      .catch((err) => {
        setLoginError(true)
      })
      
  }

  return (
    <div className={' max-w-5xl mx-auto p-5 mt-10 bg-white'}>
      <div className='text-2xl font-normal py-1'>GRASP Login</div>
      <div className='flex flex-col space-y-3 items-center justify-center'>
        <div className='w-1/3'>
          <Label htmlFor='userName'>Username</Label>
          <Input
            id='userName'
            describedBy='userName'
            showStateIcon={true}
            status={loginError ? 'error' : '' }
            value={userName}
            onChange={(e => setUserName(e.target.value))}
          />
        </div>
        <div className='w-1/3'>
          <Label htmlFor='ghToken'>Github PAT</Label>
          <PasswordInput 
            id='ghToken'
            showStateIcon={true}
            status={loginError ? 'error' : ''}
            hideButton={true}
            value={ghtoken}
            onChange={(e => setghToken(e.target.value))}
          />
        </div>
        <div>
          <Button styleType="primary" size="md" onClick={handleLogin}>Submit</Button>
        </div>
      </div>
    </div>
  )
}

export default Login
